//document.domain = "aimer.com.cn"; 

var cat_list_html = '  <ul>    <li class="submenu_li subn_trigger" >      <h3><a href="/list/t,101#at" target="_blank">文胸</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,101/p83,353" target="_blank">聚拢</a> <a href="/list/t,101/p83,356#at" target="_blank">无痕</a> <a href="/list/t,101/p1,364#at" target="_blank">深V</a> </p>      <p class="submenu_p"> <a href="/list/t,101/p1,363#at" target="_blank">抹胸</a> <a href="/list/t,101/p3,13#at" target="_blank">水袋</a> </p>      <!--文胸两级导航-->      <div class="sidebar" id="submenu_li_1" >        <ul class="sidebarleft noboder">     <h4><a href="/list/t,101#at" target="_blank">所有文胸</a><em></em></h4>     <li>            <h4>按功能</h4>            <p> <a href="/list/t,101/p83,353" target="_blank">聚拢</a> <a href="/list/t,101/p83,354#at" target="_blank">拖高</a> <a href="/list/t,101/p83,355#at" target="_blank" class="noboder">侧收</a><br />              <a href="/list/t,101/p83,356#at" target="_blank">无痕</a> <a href="/list/t,101/p83,357#at" target="_blank">美背</a> <a href="/list/t,101/p83,358#at" target="_blank" class="noboder">前系扣</a> <a href="/list/t,101/p83,359#at" target="_blank">无钢托</a> <a href="/list/t,101/p83,360#at" target="_blank" class="noboder">可摘卸肩带</a> </p>          </li>          <li>            <h4>按杯型</h4>            <p> <a href="/list/t,101/p1,2#at" target="_blank">1/2杯</a> <a href="/list/t,101/p1,1#at">3/4杯</a> <a href="/list/t,101/p1,4#at" target="_blank" class="noboder">4/4杯</a> <a href="/list/t,101/p1,3#at" target="_blank">三角杯</a> <a href="/list/t,101/p1,363#at" target="_blank">抹胸</a><br /><a href="/list/t,101/p83,362#at" target="_blank" >大罩杯</a> <a href="/list/t,101/p1,364#at" target="_blank" class="noboder">深V</a></p>          </li>          <li>            <h4>按薄厚</h4>            <p> <a href="/list/t,101/p2,5#at" target="_blank">超薄杯</a> <a href="/list/t,101/p2,6#at" target="_blank">薄杯</a> <a href="/list/t,101/p2,7#at" target="_blank" class="noboder">中杯</a> <a href="/list/t,101/p2,343#at" target="_blank">厚杯</a> <a href="/list/t,101/p2,9#at" target="_blank">加厚杯</a><br /><a href="/list/t,101/p3,13#at" target="_blank">水袋杯</a><br />            </p>          </li>          <li class="noboder">            <h4>罩杯材质</h4>            <p> <a href="/list/t,101/p3,361#at" target="_blank">超薄蕾丝</a> <a href="/list/t,101/p3,12#at" target="_blank">无纺布</a> <br />              <a href="/list/t,101/p3,11#at" target="_blank">模杯</a> <a href="/list/t,101/p3,13#at" target="_blank">水袋杯</a> </p>          </li>        </ul>        <ul class="sidebarrightimg">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,101/b,11#at" target="_blank">爱慕</a> <a href="/list/t,101/b,16#at" target="_blank">心爱</a> <a href="/list/t,101/b,14#at" target="_blank">爱美丽</a> <a href="/list/t,101/b,12#at" target="_blank">La clover</a><a href="/list/t,101/b,15#at" target="_blank">爱慕儿童</a> </p>          </li>    <li class="noboder"></li></ul></div>    </li>    <li class="submenu_li"  >      <h3><a href="/list/t,102#at" target="_blank">内裤</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,102/p69,317#at" target="_blank">女士内裤</a> <a href="/list/t,102/p69,318#at" target="_blank">男士内裤</a> </p>      <p class="submenu_p"> <a href="/list/t,102/p69,319#at" target="_blank">儿童内裤</a> <a href="/list/t,102/p84,345#at" target="_blank">无痕内裤</a> </p>      <!--内裤 2级 导航-->      <div class="sidebar" id="submenu_li_2">        <ul class="sidebarleft">     <h4><a href="/list/t,102#at" target="_blank">所有内裤</a><em></em></h4>     <li>            <h4><a href="/list/t,102/p69,317#at" target="_blank" class="sidehcolor">女士内裤</a></h4>            <p> <a href="/list/t,102/p69,317/p15,83#at" target="_blank">三角裤</a> <a href="/list/t,102/p69,317/p15,84#at" target="_blank">平角裤</a> <a href="/list/t,102/p69,317/p15,85#at" target="_blank" class="noboder">T裤</a><br />              <a href="/list/t,102/p69,317/p16,88#at" target="_blank">低腰裤</a> <a href="/list/t,102/p69,317/p16,89#at" target="_blank">中腰裤</a><br /><a href="/list/t,102/p69,317/p16,90#at" target="_blank" >高腰裤</a> <a href="/list/t,102/p69,317/p84,345#at" target="_blank">无痕内裤</a><br /><a href="/list/t,102/p69,317/p84,346#at" target="_blank" class="noboder">生理裤</a> </p>          </li>          <li>            <h4><a href="/list/t,102/p69,318#at" target="_blank" class="sidehcolor">男士内裤</a></h4>            <p> <a href="/list/t,102/p69,318/p15,83#at" target="_blank">三角裤</a> <a href="/list/t,102/p69,318/p15,84#at" target="_blank">平角裤</a></p>          </li>          <li class="noboder">            <h4><a href="/list/t,102/p69,319#at" target="_blank" class="sidehcolor">儿童内裤</a></h4>            <p> <a href="/list/t,102/p69,319/p15,83#at" target="_blank">三角裤</a> <a href="/list/t,102/p69,319/p15,84#at" target="_blank">平角裤</a></p>          </li>        </ul>        <ul class="sidebarright">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,102/b,11#at" target="_blank">爱慕</a> <a href="/list/t,102/b,16#at" target="_blank">心爱</a> <a href="/list/t,102/b,14#at" target="_blank">爱美丽</a> <a href="/list/t,102/b,12#at" target="_blank">La clover</a> <a href="/list/t,102/b,15#at" target="_blank">爱慕儿童</a> </p>          </li> </ul> </div>    </li>    <li class="submenu_li" >      <h3><a href="/list/t,103#at" target="_blank">睡衣</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,103/p69,317#at" target="_blank">女士睡衣</a> <a href="/list/t,103/p69,318#at" target="_blank">男士睡衣</a> </p>      <p class="submenu_p"> <a href="/list/t,103/p69,319#at" target="_blank">儿童睡衣</a><a href="/list/t,103/p21,368#at" target="_blank"> 亲子装</a> </p>      <!--睡衣 2级 导航-->      <div class="sidebar"  id="submenu_li_3">        <ul class="sidebarleft noboder">    <h4><a href="/list/t,103#at" target="_blank">所有睡衣</a><em></em></h4>      <li>            <h4><a href="/list/t,103/p69,317#at" target="_blank" class="sidehcolor">女士睡衣</a></h4>            <p> <a href="/list/t,103/p69,317/p20,118#at" target="_blank">小吊衣</a> <a href="/list/t,103/p69,317/p20,347#at" target="_blank">睡裙</a> <a href="/list/t,103/p69,317/p20,124#at" target="_blank" class="noboder">睡袍</a><br />              <a href="/list/t,103/p69,317/p20,348#at" target="_blank">睡衣上装</a> <a href="/list/t,103/p69,317/p20,122#at" target="_blank">睡衣下装</a><br /><a href="/list/t,103/p69,317/p20,123#at" target="_blank">套装</a> <a href="/list/t,103/p69,317/p21,129#at" target="_blank">可外穿款</a><br />            </p>          </li>          <li>            <h4><a href="/list/t,103/p69,318#at" target="_blank" class="sidehcolor">男士睡衣</a></h4>            <p> <a href="/list/t,103/p69,318/p20,348#at" target="_blank">睡衣上装</a> <a href="/list/t,103/p69,318/p20,122#at" target="_blank">睡衣下装</a>	      <a href="/list/t,103/p69,318/p20,123#at" target="_blank">分身套装</a> <a href="/list/t,103/p69,318/p21,368#at" target="_blank" class="noboder">亲子装</a></p></li>          <li class="noboder">            <h4><a href="/list/t,103/p69,319#at" target="_blank" class="sidehcolor">儿童睡衣</a></h4>            <p><a href="/list/t,103/p69,319/p20,348#at" target="_blank">睡衣上装</a> <a href="/list/t,103/p69,319/p20,122#at" target="_blank">睡衣下装</a><br /><a href="/list/t,103/p69,319/p21,368#at" target="_blank">亲子装</a></p>          </li>        </ul>        <ul class="sidebarrightimg">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,103/b,11#at" target="_blank">爱慕</a> <a href="/list/t,103/b,16#at" target="_blank">心爱</a> <a href="/list/t,103/b,14#at" target="_blank">爱美丽</a> <a href="/list/t,103/b,12#at" target="_blank">La clover </a><a href="/list/t,103/b,13#at" target="_blank">爱慕先生</a> <a href="/list/t,103/b,15#at" target="_blank">爱慕儿童</a> </p>          </li>      <li class="noboder"></li> </ul>      </div>    </li>    <li class="submenu_li" >      <h3><a href="/list/t,105#at" target="_blank">塑身衣</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,105/p30,386#at" target="_blank">腰封</a> <a href="/list/t,105/p30,181#at" target="_blank">塑裤</a> </p>      <p class="submenu_p"> <a href="/list/t,105/p30,180#at" target="_blank">塑身胸衣</a> </p>      <!--塑身衣 2级 导航-->      <div class="sidebar"  id="submenu_li_4">        <ul class="sidebarleft noboder">     <h4><a href="/list/t,105#at" target="_blank">所有塑身衣</a><em></em></h4>      <li class="noboder">            <h4>按款式</h4>            <p> <a href="/list/t,105/p30,181#at" target="_top">塑裤</a> <a href="/list/t,105/p30,386#at" target="_blank">腰封</a> <a href="/list/t,105/p30,182#at" target="_blank" class="noboder">背背佳</a><br />              <a href="http://www.aimer.com.cn/list/k,%E8%B0%83%E6%95%B4%E5%9E%8B%E6%96%87%E8%83%B8">调整型文胸</a> <a href="/list/t,105/p30,180#at" target="_blank">塑身胸衣</a></p>          </li>        </ul>        <ul class="sidebarrightimg">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,105/b,11#at" target="_blank">爱慕</a> <a href="/list/t,105/b,16#at" target="_blank">心爱</a> <a href="/list/t,105/b,14#at" target="_blank">爱美丽</a> <a href="/list/t,105/b,12#at" target="_blank">La clover</a> </p>          </li>  <li class="noboder"></li></ul>      </div>    </li>    <li class="submenu_li"  >      <h3><a href="/category/swim.shtml" target="_blank">泳衣</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,106/p44,261#at" target="_blank">连体泳衣</a> <a href="/list/t,106/p44,263#at" target="_blank">比基尼</a> </p>      <p class="submenu_p"> <a href="/list/t,106/p69,318#at" target="_blank">男士泳裤</a> <a href="/list/t,106/p69,319#at" target="_blank">儿童泳衣</a> </p>      <!--泳衣 2级 导航-->      <div class="sidebar" id="submenu_li_5">        <ul class="sidebarleft noboder">    <h4><a href="/category/swim.shtml" target="_blank">所有泳衣</a><em></em></h4>       <li>            <h4><a href="/list/t,106/p69,317/#at" target="_blank" class="sidehcolor">女士泳衣</a></h4>            <p> <a href="/list/t,106/p44,263#at" target="_blank">比基尼</a> <a href="/list/t,106/p44,262#at" target="_blank">分身泳衣</a><br /><a href="/list/t,106/p44,261#at" target="_blank">连体泳衣</a>              <a href="/list/t,106/p44,369#at" target="_blank">泳裤</a><br><a href="/list/t,106/p44,264#at" target="_blank">沙滩裙/纱/裤</a></p>          </li>          <li>            <h4><a href="/list/t,106/p69,318/#at" target="_blank" class="sidehcolor">男士泳衣</a></h4>            <p> <a href="/list/t,106/p44,369#at" target="_blank">泳裤</a></p>          </li>          <li class="noboder">            <h4><a href="/list/t,106/p69,319/#at" target="_blank" class="sidehcolor">儿童泳衣</a></h4>            <p> <a href="/list/t,106/p69,319#at" target="_blank">男孩泳裤</a> <a href="http://www.aimer.com.cn/list/k,%E5%A5%B3%E5%AD%A9%E6%B3%B3%E8%A1%A3">女孩泳衣</a></p>          </li>        </ul>        <ul class="sidebarright">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,106/b,11#at" target="_blank">爱慕</a> <a href="/list/t,106/b,16#at" target="_blank">心爱</a> <a href="/list/t,106/b,14#at" target="_blank">爱美丽</a><a href="/list/t,106/b,13#at" target="_blank">爱慕先生</a><a href="/list/t,106/b,15#at" target="_blank">爱慕儿童</a></p>          </li>  <li class="noboder"></li>  </ul>      </div>    </li>    <li class="submenu_li" >      <h3><a href="/list/t,104#at" target="_blank">保暖衣</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,104/p37,217#at" target="_blank">低领上衣</a> <a href="/list/t,104/p37,221#at" target="_blank">保暖裤</a> </p>      <p class="submenu_p"> <a href="/list/t,104/p85,371#at" target="_blank">时尚外穿</a></p>      <!--保暖衣 2级 导航-->      <div class="sidebar"  id="submenu_li_6">        <ul class="sidebarleft">   <h4><a href="/list/t,104#at" target="_blank">所有保暖衣</a><em></em></h4>       <li>            <h4><a href="/list/t,104/p69,317/#at" target="_blank" class="sidehcolor">女士保暖衣</a></h4>            <p> <a href="/list/t,104/p69,317/p37,217#at" target="_blank">低领上衣</a> <a href="/list/t,104/p69,317/p37,218#at" target="_blank">高领上衣</a><a href="/list/t,104/p69,317/p37,219#at" target="_blank">保暖背心</a>              <a href="/list/t,104/p69,317/p37,221#at" target="_blank">保暖裤</a><br /><a href="/list/t,104/p37,222#at" target="_blank">保暖套装</a></p>          </li>          <li>            <h4><a href="/list/t,104/p69,318/#at" target="_blank" class="sidehcolor">男士保暖衣</a></h4>            <p> <a href="/list/t,104/p69,318/p37,218#at" target="_blank">高领上衣</a><a href="/list/t,104/p69,318/p37,217#at" target="_blank"> 低领上衣</a></p>          </li>          <li>            <p><a href="/list/t,104/p69,318/p37,221#at" target="_blank">保暖裤</a> <a href="/list/t,104/p69,318/p37,222#at" target="_blank">保暖套装</a></p>          </li>          <li class="noboder">            <h4>儿童保暖</h4>            <p> <a href="http://www.aimer.com.cn/list/k,%E7%94%B7%E5%AD%A9%E4%BF%9D%E6%9A%96%E4%B8%8A%E8%A1%A3">男孩保暖上衣</a><br /><a href="/list/t,104/p69,319/p37,221#at" target="_blank">女孩保暖裤</a></p>          </li>        </ul>        <ul class="sidebarright">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/b,11/t,104#at" target="_blank">爱慕</a> <a href="/list/t,104/b,16#at" target="_blank">心爱</a> <a href="/list/t,104/b,14#at" target="_blank">爱美丽</a><a href="/list/t,104/b,13#at" target="_blank">爱慕先生</a><a href="/list/t,104/p69,319#at" target="_blank">爱慕儿童</a></p>          </li>        </ul>      </div>    </li>    <li class="submenu_li"  >      <h3><a href="/list/t,108#at" target="_blank">运动</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,108/p90,381#at" target="_blank">瑜伽服</a> <a href="/list/t,108/p90,380#at" target="_blank">运动服</a> </p>      <!--运动 2级 导航-->      <div class="sidebar" id="submenu_li_7">        <ul class="sidebarleft noboder">     <h4><a href="/list/t,108#at" target="_blank">所有运动</a><em></em></h4>      <li>            <h4>女士运动</h4>            <p> <a href="/list/t,108/p69,317/p89,377#at" target="_blank">运动上衣</a> <a href="/list/t,108/p69,317/p89,378#at" target="_blank">运动下装</a>      <a href="/list/t,108/p69,317/p90,381#at" target="_blank">瑜伽系列</a> <a href="/list/t,108/p69,317#at" target="_blank">运动系列</a></p>          </li>          <li class="noboder">            <h4><a href="/list/t,108/p69,318/#at" target="_blank" class="sidehcolor">男士运动</a></h4>            <p> <a href="/list/t,108/p69,318/p89,377#at" target="_blank">运动上衣</a> <a href="/list/t,108/p69,318/p89,378#at">运动下装</a> </p>          </li>        </ul>        <ul class="sidebarright">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,108/b,11#at" target="_blank">爱慕</a><a href="/list/t,108/b,13#at" target="_blank">爱慕先生</a></p>          </li>        </ul>      </div>    </li>    <li class="submenu_li">      <h3><a href="/list/t,107#at">配饰</a><em></em></h3>      <p class="submenu_p"> <a href="/list/t,107/p88,374#at" target="_blank">耳饰</a> <a href="http://www.aimer.com.cn/list/k,%E8%A3%85%E9%A5%B0%E8%82%A9%E5%B8%A6">装饰肩带</a> </p>      <p class="submenu_p"> <a href="http://www.aimer.com.cn/list/k,%E6%8F%92%E7%89%87">插片</a> </p>      <!--饰品 2级 导航-->      <div class="sidebar"  id="submenu_li_10" >        <ul class="sidebarleft noboder">     <h4><a href="/list/t,107#at" target="_blank">所有配饰</a><em></em></h4>      <li>            <h4>饰品</h4>            <p> <a href="/list/t,107/p88,373#at" target="_blank">项链</a> <a href="/list/t,107/p88,374#at" target="_blank">耳饰</a><br/><a href="http://www.aimer.com.cn/list/k,%E6%89%8B%E9%93%BE%E5%88%86%E4%B9%8B%E6%89%8B%E9%95%AF">手链/手镯</a><a href="http://www.aimer.com.cn/list/k,%E9%92%A5%E5%8C%99%E9%93%BE">钥匙链</a></p>          </li>          <li>            <h4>附件</h4>            <p>  <a href="http://www.aimer.com.cn/list/k,%E8%82%A9%E5%B8%A6">肩带</a><a href="http://www.aimer.com.cn/list/k,%E7%A1%85%E8%83%B6%E6%96%87%E8%83%B8">硅胶文胸</a><a href="http://www.aimer.com.cn/list/k,%E5%90%8A%E8%A2%9C%E5%B8%A6">吊袜带</a></p>          </li>        </ul>        <ul class="sidebarright">          <li class="noboder">            <h4>按品牌</h4>            <p> <a href="/list/t,107/b,16#at" target="_blank">心爱</a> <a href="/list/t,107/b,14#at" target="_blank">爱慕</a></p>          </li>        </ul>      </div>    </li>  </ul>';
/*收藏本站*/
function AddFavorite(sURL, sTitle){
  try{
    window.external.addFavorite(sURL, sTitle);
  }catch (e){
    try{
      window.sidebar.addPanel(sTitle, sURL, "");
    }catch (e){
      alert("加入收藏失败，请使用Ctrl+D进行添加");
    }
  }
}

function openWindow(aURL, aName, aWidth, aHeight)
{
  var aTop = (screen.height - aHeight) / 2;
  var aLeft = (screen.width - aWidth) / 2;
  var lFeatures = "menubar=No,scrollbars=Yes,titlebar=No,center=Yes,toolbar=No,resizable=No,status=No,top="+aTop+",left="+aLeft+",width=" + aWidth + ",height=" + aHeight;
  window.open(aURL, aName, lFeatures);
}

function tload( n )
{
  var str = n;
  //分割字符串
  var str_arr = str.split( "_" );
  var parent_id = str_arr[0];
  var child_id = str_arr[1];
  //展开
  dis( parent_id );

  var html = $("#content"+str ).html();
  html = "<b style='color:red'>" + html + "</b>";
  $("#content"+str ).html( html );
}

/*重新加载页面*/
function reload() {
  window.location.reload();
}


/************
 *登录|注册
 *****************/
var out_user_id = 0;
var CURRENT_USER;
function statusUpdate()
{
  $.ajax(
  {
    type: "POST",
    url: "/passport/status",
    async: false,
    dataType: "json",
    success: function( response )
    {
      if (response.status == "ok")
      {
        var currentUrl = window.location.href;
        switch( currentUrl )
        {
          case "http://www.aimer.com.cn/shopcart":
          case "http://www.aimer.com.cn/shopcart/confirm":
          case "http://www.aimer.com.cn/shopcart/payment":
            break;
          default:
            var floatShopCart = '<a id="nalkerbtn" title="在线客服" onclick="javascript:NTKF.im_openInPageChat( \'kf_9993_1359006694030\' );" href="javascript:void(0)" class="pBloclIcon pBKef"></a>';
            floatShopCart += '<a href="http://www.aimer.com.cn/shopcart" class="pBloclIcon pBCar" id="suspendobj"><em class="pBCarem" id="fscgoodscount">0</em></a>';
            floatShopCart += '<a href="javascript:window.scrollTo( 0, 0 );" class="pBloclIcon pBDb"></a><div class="pBloclNumer" id="showAddNum">+1</div>';
            $( "#floatshopcart" ).html( floatShopCart );
            break;
        }
        myDate = new Date();
        var hours = myDate.getHours();
        var cont = '';
        if( hours >= 0 && hours < 5 )
        {
          cont = ',<span style="color:#666;">夜深了,注意休息</span>'
        }
        else if( hours >= 5 && hours < 8 )
        {
          cont = ',早上好'
        }
        else if( hours >= 8 && hours < 11 )
        {
          cont = ',上午好'
        }
        else if( hours >= 11 && hours < 14 )
        {
          cont = ',中午好'
        }
        else if( hours >= 14 && hours < 19 )
        {
          cont = ',下午好'
        }
        else if( hours >= 19 && hours <= 23 )
        {
          cont = ',<span style="color:#666;">晚上好</span>'
        }

        var regEmail = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
        var regPhone = /^1((3|5|8)\d{9}|4(5|7)\d{8}|70(0|9)\d{7}|77\d{8})$|^[1,6,7,9](?:\d{7}|\d{8})$|^[6,7,9]\d{10}$|^[1,5,6,9]\d{12}$/;
        CURRENT_USER = response.data;
        out_user_id = CURRENT_USER.out_user_id;
          
        if( regEmail.test( CURRENT_USER.nickname ) )
        {
          var nameArray = CURRENT_USER.nickname.split( "@" );
          var len = nameArray[0].length;
          var str = "";
          //显示前5位，其他以*代替，*最多显示5个。
          if( len < 6 )
          {
            str = nameArray[0];
          }
          else
          {
            str = CURRENT_USER.nickname.substr( 0, 5 );
            for( var i = 1; i < Math.min( len - 5, 6); i++ )
            {
              str += "*";
            }
          }
          CURRENT_USER.nickname = str + "@" + nameArray[1];
        }
          
        if( regPhone.test( CURRENT_USER.nickname ) )
        {
          CURRENT_USER.nickname = CURRENT_USER.nickname.substr(0,3) + "****" + CURRENT_USER.nickname.substr(7,4);
        }
        $("#topNav").html( "<li><font class=\"track\" >"+CURRENT_USER.nickname+cont+"&nbsp</font><a href=\"http://www.aimer.com.cn/passport/logout\">退出</a></li><em></em>" );
        $("#cart").html("<span class=\"cartButtonH2\"><a href=\"/shopcart/confirm\"><img src=\"http://img.aimer.com.cn/default/images/settlement.jpg\" width=\"140\" height=\"32\"> </a></span><span class=\"cartButtonH1\"><img src=\"http://img.aimer.com.cn/default/images/continue.jpg\" width=\"107\" height=\"27\" onClick=\"history.back()\" /></span>");
      }
      else
      {
        var floatShopCart = '<a id="nalkerbtn" title="在线客服" onclick="javascript:NTKF.im_openInPageChat( \'kf_9993_1359006694030\' );" href="javascript:void(0)" class="pBloclIcon pBKef"></a>';
        floatShopCart += '<a href="javascript:newLogin()" class="pBloclIcon pBCar02" id="suspendobj"><em class="pBCarem" id="fscgoodscount">0</em></a>';
        floatShopCart += '<a href="javascript:window.scrollTo( 0, 0 );" class="pBloclIcon pBDb"></a><div class="pBloclNumer" id="showAddNum">+1</div>';
        $( "#floatshopcart" ).html( floatShopCart );
      }
    }
  });
}

//登陆
function newLogin()
{
  if( 0 < location.href.indexOf( "?returnurl=" ) )
  {
    var urls = location.href.split( "?returnurl=" );
    window.location.href = "http://www.aimer.com.cn/passport/login?returnurl=" + urls.pop();
  }
  else
  {
    window.location.href = "http://www.aimer.com.cn/passport/login?returnurl=" + location.href;
  }
}

//操作中登陆
function operatorLogin()
{
  window.location.href = "http://www.aimer.com.cn/passport/reglog?returnurl=" + location.href;
}

//点击注册，记录次数
function SwitchingToRegister()
{
  _mvq.push(['$logAction', 'regbtnclick']); 
  _mvq.push(['$logData']);
  if( 0 < location.href.indexOf( "?returnurl=" ) )
  {
    var urls = location.href.split( "?returnurl=" );
    window.location.href = "http://www.aimer.com.cn/passport/register?returnurl=" + urls.pop();
  }
  else
  {
    window.location.href = "http://www.aimer.com.cn/passport/register?returnurl=" + location.href;
  }
}

var time_id = "";
function getTimes( endtime, button, elobj )
{
  var date = new Date();
  var time = date.getTime();
  var lftime = endtime - time;
  if( lftime <= 0 )
  {
    clearInterval( time_id );
    if( elobj )
    {
      $( button ).html( "" ).hide();
      $( elobj ).parent().addClass( "loginObtain" );
    }
    else
    {
      $( button ).removeAttr( "disabled" );
      $( button ).attr( "value", "获取校验码" );
    }
  }
  else
  {
    var nS = Math.floor( lftime/1000 ) % 60;
    if( elobj )
    {
      $( button ).html( "您可以 <span class='v6seconds'>" + nS + " </span>秒以后要求系统重新发送" );
    }
    else
    {
      $( button ).attr( "value", "获取校验码(" + nS + ")" );
    }
  }
}
  
/*关闭登录窗口*/
function close_loginNews(obj) {
  $(".loginNews").css("top", "100px");
  $(obj).parent().hide()
}

/*商品浏览记录*/
var cookie_handle = "am_view_goods_history";
//添加cookie
function writeGoodsIdToCookie(objValue)
{
  //设置cookie的名字和时间
  var max_count = 5;
  var cookie_time_out = 3600 * 24 * 365;
  //一年
  var date = new Date();
  var old_str = "";
  var goods_ids_str = "";
  date.setTime(date.getTime() + cookie_time_out);
  //时间追加

  //获取原有cookie
  old_str = getViewHistoryCookies(cookie_handle);
  //拼接当前cookie
  if (!old_str)
    goods_ids_str = escape(objValue);
  else
    goods_ids_str = old_str + "," + escape(objValue);

  var goods_ids_arr = goods_ids_str.split(",");
  //去重复
  goods_ids_arr = unique(goods_ids_arr);
  var len = goods_ids_arr.length;
  //如果数量超过了最大限额，将前面的 N  - 5 个移除掉
  if (len > max_count)
    goods_ids_arr.splice(0, len - max_count);

  goods_ids_str = goods_ids_arr.join(",");

  var str = cookie_handle + "=" + goods_ids_str;
  //
  str += "; expires=" + date.toGMTString();
  //带上时间
  str += "; path=/";
  str += "; domain=aimer.com.cn"
  document.cookie = str;
}

//获取商品浏览记录cookie
function getViewHistoryCookies()
{
  var arrStr = document.cookie.split( "; " );
  if ( arrStr.length > 0 )
  {
    for ( var i = 0; i < arrStr.length; i++ )
    {
      var temp = arrStr[i].split("=");
      if (temp[0] == "am_view_goods_history")
      {
        return unescape(temp[1]);
      }
    }
    return null;
  }
  else
    return null;
}

/*ajax 加载商品浏览记录*/
function ajaxShowHistorys( style_id )
{
  var cookies = getViewHistoryCookies();
  if ( cookies )
  {
    $.get("/goods/cookiehistory/?ids=" + cookies, function( ret )
    {
      var html = "";
      if (ret.status == 'ok') 
      {
        $.each(ret.data,function(i, item) 
        {
          html += '<li class="setRUlli"><p><a href="'+item.url+'" rel="goods_history" target="_blank"><img src="'+item.img_url+'" alt="'+item.name+'" width="145" height="180" /></a></p>' +
                  '<a class="setRName" href="'+item.url+'" rel="goods_history" target="_blank">'+item.name+'</a><div class="setRMoney">';
          if( item.price == item.mkt_price )
          {
            html += '<span class="pageBoxPrice">¥<em>'+item.price+'</em></span></div></li>';
          }
          else
          {
            html += '<span class="pageBoxPrice">¥<em>'+item.price+'</em></span><span style="margin-left:2px;"><del>¥'+item.mkt_price+'</del></span></div></li>';
          }
        });
        $( "#" + style_id ).html( html );
      }
    }, 'json');
  }
}

//为登陆添加回车事件
$( function()
{
  $( "#username" ).keydown( function( event )
  {
    var code = event.keyCode;
    if( code == 13 )
    {
      if( $( "#username" ).val() == "")
      {
        alert( "请输入用户名！" );
        return;
      }
      if( $( "#txtPwd" ).val() == "" )
      {
        alert( "请输入密码！" );
        return;
      }
      $('#loginform').submit();
    }
  });
  $( "#txtPwd" ).keydown( function( event )
  {
    var code = event.keyCode;
    if( code == 13 )
    {
      if( $( "#username" ).val() == "")
      {
        alert( "请输入用户名！" );
        return;
      }
      if( $( "#txtPwd" ).val() == "" )
      {
        alert( "请输入密码！" );
        return;
      }
      $('#loginform').submit();
    }
  });
  $( "#password" ).keydown( function( event )
  {
    var code = event.keyCode;
    if( code == 13 )
    {
      if( $( "#email" ).val() == "" )
      {
        alert( "请输入用户名!" );
        return;
      }
      if( $( "#password" ).val() == "" )
      {
        alert( "请输入密码!" );
        return;
      }
      document.getElementById('form1').submit();
    }
  });
  $( "#email" ).keydown( function( event )
  {
    var code = event.keyCode;
    if( code == 13 )
    {
      if( $( "#email" ).val() == "" )
      {
        alert( "请输入用户名!" );
        return;
      }
      if( $( "#password" ).val() == "" )
      {
        alert( "请输入密码!" );
        return;
      }
      document.getElementById('form1').submit();
    }
  });
});
//页面加载完成后，所有事件
$(function() {
  $("#cat_list").html( cat_list_html );
  //  $("#login_window").html( login_window_html );
  $("#win_login").css( "left",screen.width / 2 - $("#win_login").width() / 2);
  $("#win_login").css( "top","150px");
  
  //遮罩效果
  $(".arrivalleft").find("a").each(function() {
    $(this).hover(function() {
      $(this).siblings().find(".mask").stop();
      $(this).siblings().find(".mask").fadeTo("fast",0.3);
    },
    function() {
      $(this).siblings().find(".mask").stop();
      $(this).siblings().find(".mask").fadeTo( "fast", 0 );
    });
  });

  //页面头部购物车下拉
  $(".dropbox_show").hover(function(){
    $(".dropbox").slideDown( "fast" );
  },
  function(){
    var slideuptimer = setTimeout( "$(\".dropbox\").slideUp( \"fast\" )", 1000 );
    $(".dropbox").hover(function(){
      clearTimeout(slideuptimer);
    },
    function(){
      $(".dropbox").slideUp( "fast" );
    });
  });

  //全部分类下拉
  $(".submenu_li").hover(function(){
    $(this).addClass( "subn_trigger" ).siblings().removeClass( "subn_trigger");
    $(this).find( ".sidebar" ).show();
    $(this).siblings().find( ".sidebar" ).hide();
  },
  function(){
    });

  $(".menu").hover(function(){
    $( ".submenu" ).slideDown( "fast" );
  },
  function(){
    var Downuptimer = setTimeout( "$(\".submenu\").slideUp( \"fast\" );$(\".submenu .sidebar\").hide();$(\".submenu_li\").removeClass( \"subn_trigger\")", 1000 );
    $(".menu .submenu").hover(function(){
      clearTimeout(Downuptimer);
    },
    function(){
      });
  });

  //头部我的账户下拉
  $(".show_user").hover(function(){
    $(".dropbox01").slideDown( "fast" );
  },
  function(){
    var slideuptimer = setTimeout( "$(\".dropbox01\").slideUp( \"fast\" )", 1000 );
    $(".dropbox01").hover(function(){
      clearTimeout(slideuptimer);
    },
    function(){
      $(".dropbox01").slideUp( "fast" );
    });
  });


  //头部我的爱慕下拉
  $(".show_user001").hover(function(){
    $(".dropbox001").slideDown( "fast" );
  },
  function(){
    var slideuptimer = setTimeout( "$(\".dropbox001\").slideUp( \"fast\" )", 1000 );
    $(".dropbox001").hover(function(){
      clearTimeout(slideuptimer);
    },
    function(){
      $(".dropbox001").slideUp( "fast" );
    });
  });
  
  //头部服务中心下拉
  $(".show_user002").hover(function(){
    $(".dropbox002").slideDown( "fast" );
  },
  function(){
    var slideuptimer = setTimeout( "$(\".dropbox002\").slideUp( \"fast\" )", 1000 );
    $(".dropbox002").hover(function(){
      clearTimeout(slideuptimer);
    },
    function(){
      $(".dropbox002").slideUp( "fast" );
    });
  });

  //头部网站导航下拉
  $(".show_user003").hover(function(){
    $(".dropbox003").slideDown( "fast" );
  },
  function(){
    var slideuptimer = setTimeout( "$(\".dropbox003\").slideUp( \"fast\" )", 1000 );
    $(".dropbox003").hover(function(){
      clearTimeout(slideuptimer);
    },
    function(){
      $(".dropbox003").slideUp( "fast" );
    });
  });

  //品牌馆 下拉
  $(".show_pinpai").hover(function(){
    $(".dropbox02").slideDown( "fast" );
  },
  function(){
    var slideuptimer = setTimeout( "$(\".dropbox02\").slideUp( \"fast\" )", 1000 );
    $(".dropbox02").hover(function(){
      clearTimeout(slideuptimer);
    },
    function(){
      $(".dropbox02").slideUp( "fast" );
    });
  });

  $(".run").hover(function(){
    var key = $(this).attr("name");
    $(this).addClass("cattieclick");
    $(this).siblings().removeClass("cattieclick");
    $("#new_goods_list_"+key).fadeIn(1000).siblings().stop().hide().css("opacity",1);
  });
});


/***数组去重复 方法***/
function unique(data) {
  var a = {};
  for (var i = 0; i < data.length; i++) {
    var v = data[i];
    if (typeof(a[v]) == 'undefined') {
      a[v] = 1;
    }
  }
  data.length = 0;
  for (var i in a) {
    data[data.length] = i;
  }
  return data;
}

$(function() {
  var sWidth = $("#focus").width(); //获取焦点图的宽度（显示面积）
  var len = $("#focus ul li").length; //获取焦点图个数
  var index = 0;
  var picTimer;
  //添加数字按钮
  var btn = "<div class='btnBg'></div><div class='btn'>";
  for(var i=0; i < len; i++) {
    btn += "<span>" + (i+1) + "</span>";
  }
  btn += "</div>"
  $("#focus").append(btn);
  $("#focus .btnBg").css("opacity",0.5);
	
  //数字按钮事件
  $("#focus .btn span").mouseenter(function() {
    index = $("#focus .btn span").index(this);
    showPics(index);
  }).eq(0).trigger("mouseenter");
	
  //计算ul总长度
  $("#focus ul").css("width",sWidth * (len + 1));
	
  //遮罩效果
  $("#focus ul li div").hover(function() {
    $(this).siblings().css("opacity",0.7);
  },function() {
    $("#focus ul li div").css("opacity",1);
  });
	
  //鼠标滑上焦点图时停止自动播放，滑出时开始自动播放
  $("#focus").hover(function() {
    clearInterval(picTimer);
  },function() {
    picTimer = setInterval(function() {
      if(index == len) { //如果索引值等于li元素个数，说明最后一张图播放完毕，接下来要显示第一张图，即调用showFirPic()，然后将索引值清零
        showFirPic();
        index = 0;
      } else { //如果索引值不等于li元素个数，按普通状态切换，调用showPics()
        showPics(index);
      }
      index++;
    },4000); //此3000代表自动播放的间隔，单位：毫秒
  }).trigger("mouseleave");
  //显示图片函数，根据接收的index值显示相应的内容
  function showPics(index) { //普通切换
    //加载图片
    $("#focus").find( "li" ).eq(index).find("img[lazy]").each( function(){
      $(this).attr("src", $(this).attr("lazy"))
    } );
           
    var nowLeft = -index*sWidth; //根据index值计算ul元素的left值
    $("#focus ul").stop(true,false).animate({
      "left":nowLeft
    },500); //通过animate()调整ul元素滚动到计算出的position
    $("#focus .btn span").removeClass("on").eq(index).addClass("on"); //为当前的按钮切换到选中的效果
  }
	
  function showFirPic() { //最后一张图自动切换到第一张图时专用
    $("#focus ul").append($("#focus ul li:first").clone());
    var nowLeft = -len*sWidth; //通过li元素个数计算ul元素的left值，也就是最后一个li元素的右边
    $("#focus ul").stop(true,false).animate({
      "left":nowLeft
    },500,function() {
      //通过callback，在动画结束后把ul元素重新定位到起点，然后删除最后一个复制过去的元素
      $("#focus ul").css("left","0");
      $("#focus ul li:last").remove();
    }); 
    $("#focus .btn span").removeClass("on").eq(0).addClass("on"); //为第一个按钮添加选中的效果
  }
});

var count;
$(function() {
  $(".indexlutp").hover(function() {
    $(".lunboxx").animate({
      height: "60px"
    }, 200 );
    $(".indexlubj").animate({
      height: "60px"
    }, 200 );
  },function(){
    $(".lunboxx").animate({
      height: "40px"
    }, 200 );
    $(".indexlubj").animate({
      height: "40px"
    }, 200 );
  });

  $(".lbonums a").hover(function() {
    var key = $(this).text();
    $(this).addClass("lboclick").siblings().removeAttr("class");
    $("#downslide_"+key).fadeIn(1000).siblings().stop().hide().css("opacity",1);
  });

  var _thumbImgIndex = 0;
  $(".logoleft").click(function(){
    if( $(this).attr( "type" ) == 'down' ){
      cont = $(".brandmiddle");
      distance = '950';
      _maxCount = (cont.find("li").length) / 5;
    }else{
      cont = $(".logocontent");
      distance = '948';
      _maxCount = (cont.find("li").length) / 5;
    }

    if ( _thumbImgIndex < 0 )
      return;

    _thumbImgIndex -=5;
    cont.animate({
      scrollLeft : "-="+distance
    },2000);
  });

  $(".logoright").click(function(){


    if( $(this).attr( "type" ) == 'down' ){
      cont = $(".brandmiddle");
      distance = '400';
      _maxCount = (cont.find("li").length) / 2;
    }else{
      cont = $(".logocontent");
      distance = '398';
      _maxCount = (cont.find("li").length) / 2;
    }

    if ( _thumbImgIndex >= _maxCount )
      return;

    _thumbImgIndex +=5;
    cont.animate({
      scrollLeft : "+="+distance
    },1000);
  });
});
      
var brandslidetimer = setInterval("brandshowAuto()", 2000);
$(function() {
  $(".aimerlbwz li").hover(function(){
    clearInterval(brandslidetimer);
    var key = $(this).index() ;
    $(".brand_slide_"+(key+1)).fadeIn(100).siblings().stop().hide().css("opacity",1);
    $(".aimerlbbj li:eq("+key+")").addClass("aimertrigger").siblings().removeAttr("class");
  },function(){
    brandslidetimer = setInterval("brandshowAuto()", 2000);
  });

  $(".img").hover(function(){
    clearInterval(brandslidetimer);
  },
  function(){
    brandslidetimer = setInterval("brandshowAuto()", 2000);
  });

});
function brandshowAuto()
{
  var count = $(".aimerlbwz li").length;
  var key = $(".aimerlbbj .aimertrigger").index()+1;
  if ( key == count ){
    key = 0;
  }
  $(".aimerlbwz li:eq("+key+")").hover();
}
/*首页轮播效果 end*/

function change(type)
{
  if(type == 'register')
  { 
    _mvq.push(['$logAction', 'regbtnclick']); 
    _mvq.push(['$logData']);
    $("#login").css("display","none");
    $("#register").css("display","");
  }
  if(type == 'login')
  {
    $("#login").css("display","");
    $("#register").css("display","none");
  }
  if( type === "v6user" )
  {
    $( "#v6user" ).show();
    $( "#v6user" ).siblings().hide();
  }
}

//提交搜索
function submitSearch()
{
  var keywords = document.getElementById('kws').value;
  
  if( keywords == "" )
    keywords = document.getElementById('kwss').value;
  
  if( keywords == "" )
  {
    alert( "请输入搜索内容");
    return false;
  }
  keywords = keywords.replace(/\//i, "分之");
  keywords = encodeURIComponent( keywords );
  self.location= " /list/"+"k,"+keywords+"/?k="+keywords;
  return false;
}

function clearString(s){
  var pattern = new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>?~！@#¥……&*（）&;|{}【】‘；：”“'。，、？]")
  var rs = "";
  for (var i = 0; i < s.length; i++) {
    rs = rs+s.substr(i, 1).replace(pattern, '');
  }
  return rs;
}

//jquery cookie
jQuery.cookie=function(name,value,options){
  if(typeof value!='undefined'){
    options=options||{};

    if(value===null){
      value='';
      options.expires=-1
    }
    var expires='';
    if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){
      var date;
      if(typeof options.expires=='number'){
        date=new Date();
        date.setTime(date.getTime()+(options.expires*24*60*60*1000))
      }else{
        date=options.expires
      }
      expires='; expires='+date.toUTCString()
    }
    var path=options.path?'; path='+options.path:'';
    var domain=options.domain?'; domain='+options.domain:'';
    var secure=options.secure?'; secure':'';
    document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('')
  }else{
    var cookieValue=null;
    if(document.cookie&&document.cookie!=''){
      var cookies=document.cookie.split(';');
      for(var i=0;i<cookies.length;i++){
        var cookie=jQuery.trim(cookies[i]);
        if(cookie.substring(0,name.length+1)==(name+'=')){
          cookieValue=decodeURIComponent(cookie.substring(name.length+1));
          break
        }
      }
    }
    return cookieValue
  }
};
//create web guid
function setGUID(){
  if($.cookie("GUID")==null){
    $.cookie("GUID",GUID(),{
      expires:365000,
      path:'/',
      domain:'aimer.com.cn',
      secure:false
    })
  }
}
function GUID(){
  return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4())
}
function S4(){
  return(((1+Math.random())*0x10000)|0).toString(16).substring(1)
}

/* 手机二维码 浮动开始*/

//$(function();
//{
//    var $wapQrCapQrode = $("<div id='wapQrCapQrode'></div>")
//    $("body").append($wapQrCapQrode);
//});


/* 手机二维码 浮动结束*/


setGUID();

function showColors( img )
{
  var divObj = $( img ).parent().siblings( ".color_pieces" ).show();
  var imgHeight = img.offsetHeight;
  var divHeight = divObj.outerHeight();
  divObj.css({
    left: 1,
    top: imgHeight - divHeight + 1,
    position: "absolute",
    background: "#FFFFFF",
    width: img.offsetWidth,
    opacity: 0.8
  });
}
$( function()
{
  $( ".color_pieces" ).mouseover( function()
  {
    $( this ).show();
  });
  $( ".color_pieces" ).mouseout( function()
  {
    $( this ).hide();
  });
  statusUpdate();
});

function hideColors( img )
{
  $( img ).parent().siblings( ".color_pieces" ).hide();
}

function GetRequest() 
{
  var url = location.search; //获取url中"?"符后的字串
  var theRequest = new Object();
  if (url.indexOf( "?" ) != -1 ) 
  {
    var str = url.substr(1);
    strs = str.split( "&" );
    for(var i = 0; i < strs.length; i ++) 
    {
      theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
    }
  }
  return theRequest;
}

$(document).ready(function() {
  $("body").mousedown(function(a) {
    var e = $(a.target).closest("a");
    var d = e.attr("rel");
    if (d != undefined && d != "") {
      var c = e.attr("href");
      if (c.indexOf("ref=") > -1) {
        c = c.replace(/ref=[\w|-]*/, "ref=" + d)
      } else {
        if (c.indexOf("?") == -1) {
          c += "?ref=" + d;
        } else {
          c += "&ref=" + d;
        }
      }
      e.attr("href", c);
    }
    else
    {
      var c = e.attr("href");
      if (c != undefined && c != "") {
        if (c.indexOf("ref=") != -1) {
          var classname = e.attr('class');
          var re = /^lzw/;
          if ( re.test( classname ) ) {
            return;
          }
          c = c.replace(/\?ref=[\w|-]*&?/, "?").replace(/\&ref=[\w|-]*&?/, "&");
        }
        e.attr("href", c);
      }
    }
  })
});

//lazyload
(function(a){
  a.fn.lazyload=function(b){
    var c={
      threshold:0,
      failurelimit:0,
      event:"scroll",
      effect:"show",
      container:window,
      callback:function(){}
    };
    
    if(b){
      a.extend(c,b)
    }
    var d=this;
    if("scroll"==c.event){
      a(c.container).bind("scroll",function(g){
        var e=0;
        d.each(function(){
          if(a.abovethetop(this,c)||a.leftofbegin(this,c)){}else{
            if(!a.belowthefold(this,c)&&!a.rightoffold(this,c)){
              a(this).trigger("appear")
            }else{
              if(e++>c.failurelimit){
                return false
              }
            }
          }
        });
        var f=a.grep(d,function(h){
          return !h.loaded
        });
        d=a(f)
      });
      a(c.container)[0].manload=function(g){
        var e=0;
        d.each(function(){
          if(a.abovethetop(this,c)||a.leftofbegin(this,c)){}else{
            if(!a.belowthefold(this,c)&&!a.rightoffold(this,c)){
              a(this).trigger("appear")
            }else{
              if(e++>c.failurelimit){
                return false
              }
            }
          }
        });
        var f=a.grep(d,function(h){
          return !h.loaded
        });
        d=a(f)
      }
    }
    this.each(function(){
      var e=this;
      if(undefined==a(e).attr("original")){
        a(e).attr("original",a(e).attr("src"))
      }
      if("scroll"!=c.event||undefined==a(e).attr("src")||c.placeholder==a(e).attr("src")||(a.abovethetop(e,c)||a.leftofbegin(e,c)||a.belowthefold(e,c)||a.rightoffold(e,c))){
        if(c.placeholder){
          a(e).attr("src",c.placeholder)
        }else{
          a(e).removeAttr("src")
        }
        e.loaded=false
      }else{
        e.loaded=true
      }
      a(e).one("appear",function(){
        a("<img />").bind("load",function(){
          a(e).hide().attr("src",a(e).attr("original"))[c.effect](c.effectspeed);
          e.loaded=true;
          c.callback(e)
        }).attr("src",a(e).attr("original"))
      });
      if("scroll"!=c.event){
        a(e).bind(c.event,function(f){
          if(!e.loaded){
            a(e).trigger("appear")
          }
        })
      }
    });
    a(c.container).trigger(c.event);
    return this
  };

  a.belowthefold=function(c,d){
    if(d.container===undefined||d.container===window){
      var b=a(window).height()+a(window).scrollTop()
    }else{
      var b=a(d.container).offset().top+a(d.container).height()
    }
    return b<=a(c).offset().top-d.threshold
  };
  
  a.rightoffold=function(c,d){
    if(d.container===undefined||d.container===window){
      var b=a(window).width()+a(window).scrollLeft()
    }else{
      var b=a(d.container).offset().left+a(d.container).width()
    }
    return b<=a(c).offset().left-d.threshold
  };
  
  a.abovethetop=function(c,d){
    if(d.container===undefined||d.container===window){
      var b=a(window).scrollTop()
    }else{
      var b=a(d.container).offset().top
    }
    return b>=a(c).offset().top+d.threshold+a(c).height()
  };
  
  a.leftofbegin=function(c,d){
    if(d.container===undefined||d.container===window){
      var b=a(window).scrollLeft()
    }else{
      var b=a(d.container).offset().left
    }
    return b>=a(c).offset().left+d.threshold+a(c).width()
  };
  
  a.extend(a.expr[":"],{
    "below-the-fold":"$.belowthefold(a, {threshold : 0, container: window})",
    "above-the-fold":"!$.belowthefold(a, {threshold : 0, container: window})",
    "right-of-fold":"$.rightoffold(a, {threshold : 0, container: window})",
    "left-of-fold":"!$.rightoffold(a, {threshold : 0, container: window})"
  })
})(jQuery);

$(function()
{
  $("img[original]").lazyload({
    placeholder:"http://img.aimer.com.cn/product_pic/e.gif",
    failurelimit:10
  })
});

//shopcart.js
function shopCartLoad(){
  $.get("/shopcart/items?"+Math.random(), function(ret){
    if ( ret.status == "ok" ) {
      $("#shopcartAfterLoad").html( ret.data );
    } else {
    }
  },"json");
  updShopCartMessage();
}

function shopCartDelete( uk ){
  if( !confirm('确认删除吗？') )
    return ;

  $.get("/shopcart/delete?id="+ uk + "&" +Math.random(), function(ret){
    if ( ret.status == "ok" ) {
      shopCartLoad();
    } else {
      alert( typeof ret.data == 'undefined' ? ret : ret.data );
    }
    updShopCartMessage();
  },"json");

}

function shopCartUpdate(type,id,number,upd_type){
  if( upd_type != 'text' ){
    var sum = 0;
    $(".group_"+id).each(function(){
      sum += parseInt($(this).val());
    });
    sum += parseInt(number);
  }else{
    sum = number;
  }
  
  var url = ""
  switch( type ){
    case 'product':
      url = "/shopcart/"+id+"/updateproduct?number="+sum+"&"+Math.random()
      break;
    case 'suit':
      url = "/shopcart/updatesuit?id="+id+"&number="+sum+"&"+Math.random()
      break;
  }
  
  var errmsg = null
  $.ajax({
    url: url,
    async: false,
    dataType: 'json',
    success: function( ret ){
      if ( ret.status == "ok" ) {
        shopCartLoad();
      } else {
        errmsg = ret.data
      }
    }
  });
  
  if ( errmsg )
  {
    alert( errmsg )
    return errmsg
  }
  
  updShopCartMessage();
  
  return true;
}

/**
 * 购物车 fly对象 
 * start，    开始飞的起点id，
 * end，      飞的结束点id
 * fobj，     飞的对象
 * goodsNum，   添加了几件
 */
var flyanimote = {
   start: "",
   end: "suspendobj",
   fobj: "",
   number: "",
   init: function()
   {
     var fstart = $( "#" + this.start );
     var fend = $( "#" + this.end );
     var fobje = $( "#" + this.fobj );
     var goodsNum = this.number;
     var top = $( "#showAddNum" ).offset().top;
     var numStartTop = $( "#nalkerbtn" ).offset().top;
     fobje.css({ top: fstart.offset().top, left: fstart.offset().left }).show().animate({ top: fstart.offset().top - 260 }, 800 ).animate({ top: fend.offset().top, left: fend.offset().left }, 1000, function()
     {
       fobje.hide().offset({ top: 0, left: 0 }); 
       fend.children().text( $( "#cart_goods_number" ).text() );
       $( "#showAddNum" ).text( "+" + goodsNum );
       $( "#showAddNum" ).css({ display: "block", top: numStartTop }).show().animate({ top: numStartTop - 100 }, 1000, function(){ $( "#showAddNum" ).hide().css({ top: top });});
     });
   }
 };

function shopCartUpdateInput(type,id,input_obj){
  var number = $( input_obj ).val();
  
  if ( number == 0 ) {
    alert('数量不得小于1');
    $(input_obj).val(1);
    return;
  }
  
  var ret = shopCartUpdate(type,id,number,'text');
  
  if ( ret == '货品库存不足')
    $(input_obj).val(1)
}

//购买单品
function shopCartAddProduct( product_id, number, type, id )
{
  var ref;
  var Request = new Object();
  Request = GetRequest();
  if ( Request['ref'] == undefined || Request['ref'] == '' )
  {
    ref = "";
  }
  else
  {
    ref = Request['ref'];
  }
  $.get( "/shopcart/"+product_id+"/addproduct?number="+number+"&ref="+ref+"&inc=1&"+Math.random(), function(ret)
  {
    if ( ret.status == "ok" )
    {
      //type 不等于immediate或1时，使用block_ui效果
      if( "immediate" != type && "1" != type )
      {
        $.blockUI({
          message: $( '#affirm' ), 
          css: {
            top: ( $( window ).height() - $( '#affirm' ).height() ) /2 + 'px',
            left: ( $( window ).width() - $( '#affirm' ).width() ) /2 + 'px', 
            width: '450px', 
            padding: '10px' ,
            cursor : 'auto'
          }
        });
        $( "#" + id ).show().next().hide();
        $('#block').attr('title','点击关闭').click($.unblockUI);
        $('.pCloseCion').click($.unblockUI);
        $('.pageCartGo').click($.unblockUI);
        $("#goods_number").text( " " + ret.data.number + " " );
        $("#goods_price").text( "合计：¥ " + ret.data.price );
      }
      //更新购物车
      updShopCartMessage( type, id, product_id );
    }
    else
    {
      $( "#" + id ).show().next().hide();
      alert( ret.data );
    }
  },"json");
}

//更新购物车
function updShopCartMessage( type, id, product_id )
{
  if( $( "#cart_goods_number" ).length == 0 )
  {
    return false;
  }
  $.post( "/shopcart/items?gettype=2&"+Math.random(), function( ret )
  {
    if( "ok" === ret.status )
    {
      var sum_number = 0;
      var html = '<p>&nbsp;&nbsp;最近加入的宝贝</p>';
      $.each( ret.data, function( key, obj )
      {
        sum_number += parseInt( obj.number );
        //如果不是套装,可以有颜色 尺码
        if( obj.type == 'product' )
        {
          html += "<table width='290' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td valign='middle'><a href='/goods/"+obj.goods_id+"' target='_blank' title='"+obj.name+"'><img src='"+obj.mini_img+"' width='45' height='55' /></a></td><td class='dropboxmiddle'><p><a href='/goods/"+obj.goods_id+"' target='_blank' title='"+obj.name+"'>"+obj.name+"</a></p>";
          html +="<p>颜色分类:"+obj.colortext+"&nbsp;&nbsp;尺码:"+obj.sizetext+"</p>";
        }
        else if( obj.type == 'suit')
        {
          html += "<table width='290' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td valign='middle'><a href='/suit/"+obj.id+"' target='_blank' title='"+obj.name+"'><img src='"+obj.mini_img+"' width='45' height='55' /></a></td><td class='dropboxmiddle'><p><a href='/suit/"+obj.id+"' target='_blank' title='"+obj.name+"'>"+obj.name+"</a></p>";
          html +="<p>(套装)</p>";
        }
        else if( obj.type == 'package' )
        {
          html += "<table width='290' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td valign='middle'><a href='/package/view?package_id="+obj.id+"' target='_blank' title='"+obj.name+"'><img src='"+obj.mini_img+"' width='45' height='55' /></a></td><td class='dropboxmiddle'><p><a href='/package/view?package_id="+obj.id+"' target='_blank' title='"+obj.name+"'>"+obj.name+"</a></p>";
          html +="<p>(礼包)</p>";
        }
        html +="</td><td class='dropboxright'><p><span>¥</span>"+obj.price+"</p><p><a href=\"javascript:shopCartDelete('"+obj.uk+"');\">删除</a></td></tr></table>";
      });
      html += "<div class=\"dropcart\"><a href=\"/shopcart\">查看我的购物车</a></div>";
      $( "#cart_goods_number" ).text( sum_number );
      $( "#fscgoodscount" ).html( sum_number );
      if( sum_number == 0 )
        html = "<p>&nbsp;&nbsp;您的购物车还是空的哦,快去选购吧</p>";
      $(".dropbox").html( html );
      //type为1使用fly效果
      if( "1" == type )
      {
        //使用的是fly效果，需要回复最初状态
        $( "#" + id ).show().next().hide();
        flyanimote.start = "flystart";
        flyanimote.end = "suspendobj";
        flyanimote.fobj = "flyobj";
        flyanimote.number = $( "#goodCount" ).val();
        flyanimote.init();
      }
      //处理立即购买
      if( "immediate" == type )
      {
        $.post( "/shopcart/partaccount", { productarr: ["product:" + product_id], type: "immediate" }, function( ret )
        {
          if( "ok" == ret.status )
          {
            window.location.href = "http://www.aimer.com.cn/" + ret.data.page;
          }
        }, "json" );
      }
    }
  }, "json" );
}

//购买套装
function shopCartAddSuit( suit_id, products, number, isfly )
{
  var products_url = "";
  for( key in products )
  {
    products_url += "&products[]="+products[key].id;
  }
  
  $.get("/shopcart/"+suit_id+"/addsuit?number="+number+"&"+products_url+"&"+Math.random(), function(ret)
  {
    if ( ret.status == "ok" )
    {
      updShopCartMessage( "suit" );
      $( "#suitflystart" ).removeClass( "pageSTButClick" ).addClass( "pageSTBut" ).empty();
      if( 1 == isfly )
      {
        flyanimote.start = "suitflystart";
        flyanimote.end = "suspendobj";
        flyanimote.fobj = "flyobj";
        flyanimote.number = number;
        flyanimote.init();
      }
      else
      {
        $.blockUI({
          message: $( '#affirm' ), 
          css: {
            top: ( $( window ).height() - $( '#affirm' ).height() ) /2 + 'px',
            left: ( $( window ).width() - $( '#affirm' ).width() ) /2 + 'px', 
            width: '450px', 
            padding: '10px' ,
            cursor : 'auto'
          }
        });
        $('#block').attr('title','点击关闭').click($.unblockUI);
        $('.pCloseCion').click($.unblockUI);
        $('.pageCartGo').click($.unblockUI);
        $("#goods_number").text( " " + ret.data.number + " " );
        $("#goods_price").text( "合计：¥ " + ret.data.price );
      }
    }
    else
    {
      $( "#suitflystart" ).removeClass( "pageSTButClick" ).addClass( "pageSTBut" ).empty();
      //切割返回信息
      ShowMessage.Msg.alert( ret.data );
    }
  },"json");
}

/**
 * 添加套装到购物车的方法
 * @param {type} package_id
 * @param {type} product_ids
 * @returns {undefined}
 */
function shopCartAddPackage( package_id, product_ids )
{
  var params = "package_id=" + package_id;
  for( var i = 0; i < product_ids.length; i++ )
  {
    var product_id = product_ids[ i ];
    params += "&product_id[]=" + product_id;  
  }
  
  
  $.post( "/shopcart/add_package", params, function( ret ){
    if( ret.status == "ok" )
    {
//      ShowMessage.Msg.alert( "加入购物车成功" );
      window.location.href = "/shopcart";
    }
    else
    {
      ShowMessage.Msg.alert( ret.data );
    }
  }, "json" );
}


function shopCartAddGift( product_id,promotion_id,number )
{
  $.get("/shopcart/"+product_id+"/addgift?promotion_id="+promotion_id+"&number="+number+"&"+Math.random(), function(ret)
  {
    if ( ret.status == "ok" ) 
    {
      alert("添加成功");
      shopCartLoad();
    }
    else
    {
      alert( ret.data );
    }
  },"json");
}
//从cookie里面读取用户名和用户id，如果用户没有登录返回空
function getCookieValue( cookieName )
{
  var cookieValue = document.cookie;
  var cookieStartsAt = cookieValue.indexOf( " " + cookieName + "=" );
  if( cookieStartsAt == -1 )
    cookieStartsAt = cookieValue.indexOf( cookieName + "=" );
  if( cookieStartsAt == -1 )
  {
    cookieStartsAt = null;
    cookieValue = "";
  }
  else
  {
    cookieStartsAt = cookieValue.indexOf( "=", cookieStartsAt ) + 1;
    var cookieEndsAt = cookieValue.indexOf( ";", cookieStartsAt );
    if( cookieEndsAt == -1 )
      cookieEndsAt = cookieValue.length;
    cookieValue = cookieValue.substring( cookieStartsAt, cookieEndsAt );
  }
  return cookieValue;
}

$(document).ready(function() {
  var Url = escape( location.href );
  var parentUrl = escape( document.referrer );
  var request_url = '/statistics/?parent='+parentUrl+'&url='+Url+"&t="+Math.random();
  $.get( request_url );

  $(".foretabs li").mouseover(function(){
    $(".foretab_conbox").show();
    $(this).addClass("forethistab").show().siblings().removeClass("forethistab"); 
    var idx = $(".foretabs li").index(this);
    $(".foretab_conbox li").each(function(i,item){
      if( idx == i )
      {
        $(item).show();
      }
      else
      {
        $(item).hide();
      }
    })
  });

  $(".foretabs li").mouseleave(function(){
    $(this).removeClass("forethistab")
  });

  $("#foretabbox").mouseleave(function(){
    $(".foretab_conbox").hide();
    $(".foretabs li").removeClass("forethistab")
  });

  $(".foretab_conbox li").mouseover(function(){
    var idx = $(".foretab_conbox li").index(this);

    $(".foretabs li").each(function(i,item){

      if( idx == i )
      {
        $(item).addClass("forethistab");
      }
      else
      {
        $(item).removeClass("forethistab");
      }
    });						
  });
});

/*
 * 定义alert、confirm弹框对象
 * 使用方式(可参考account/score.tpl)：
 * ShowMessage.Msg.alert(msg,fn,width,height,title) msg:提示内容;fn:alert后执行函数;width:弹窗宽;height:弹窗高;title:提示框的标题
 * ShowMessage.Msg.confirm(msg,fn,width,height,title)  msg:提示内容;fn:confirm后执行回调函数;width:弹窗宽;height:弹窗高;title:提示框的标题
 * ShowMessage.Msg.alert("您的订单提交成功",function(){},350,50,"订单提交成功")
 * ShowMessage.Msg.confirm("是否要删除",function(){ ....},500,60)
 */
var ShowMessage={};
$(function(){
      ShowMessage.Position = {x:0,y:0,top:0,left:0};
      ShowMessage.initPosition=function(){
      ShowMessage.Position.x=$(window).height();
      ShowMessage.Position.y=$(window).width();
      ShowMessage.Position.top = $(window).scrollTop();
      ShowMessage.Position.left = $(window).scrollLeft();
    };
    ShowMessage.Msg={
      IsInit:false,  
      dvMsgBox:null,  
      InitMsg:function(width){ 
        var html='<div class="top"><div class="MsgBoxclose" onclick="MsgBoxclose()">Ｘ</div><div class="right"><div class="title" id="dvMsgTitle"></div></div></div>'+  
          '<div class="body"><div class="right"><div class="ct" id="dvMsgCT"></div></div></div>'+  
          '<div class="bottom" id="dvMsgBottom"><div class="right"><div class="btns" id="dvMsgBtns"></div></div></div>';  
        this.dvMsgBox=document.createElement("div"); 
        this.dvMsgBox.id="dvMsgBox";  
        this.dvMsgBox.innerHTML+=html;        
        document.body.appendChild(this.dvMsgBox);
        this.IsInit=true;  
      },  
     //创建按钮
     createBtn:function(p,v,fn,type){  
        var btn=document.createElement("input");  
        btn.type="button";  
        btn.className='btn';  
        btn.value=v;  
        btn.onmouseover=function(){this.className='btn';};
        btn.onmouseout=function(){this.className='btn';};  
        if( type == 'delete'){
          btn.style.width = 30 + 'px';
          btn.style.height = 16 + 'px';
        }
        //点击确认或者取消按钮时事件
        btn.onclick=function(){  
          ShowMessage.Msg.hide();
          //有回调函数就执行
          if(this.value == "确定" && ( typeof(fn) == "function" ) )
            fn(p);
          };
      return btn;  
    },  
    //alert方法
    alert:function(msg,fn,width,height,title){  
      this.show({
        buttons:{yes:'确定'},
        msg:msg,
        title:title,
        fn:fn,
        width:width,
        height:height,
        position:null,
        type:'alert'});  
    },  
    //
    confirm:function(msg,fn,width,height,title){  
      //fn为回调函数，参数和show方法的一致  
      this.show({
        buttons:{yes:'确定',no:'取消'},
        msg:msg,
        title:title,
        fn:fn,
        width:width,
        height:height,
        position:null,
        type:'confirm'});  
    }, 
    deletetips:function(msg,fn,position){
      this.show({
        buttons:{yes:'确定',no:'取消'},
        msg:msg,
        title:'提示',
        fn: fn,
        width:200,
        height:40,
        position:position, //弹窗悬浮的位置设定
        type:'delete'
      });
    },
    show:function(MsgBox){  
      if(!MsgBox)
        throw("请设定相关的参数"); 
      //没有dom对象，就初始化  
      if(!this.IsInit)
        this.InitMsg();
      //检查是否要指定宽、高，宽度默认值为340，高度默认值为55
      if(MsgBox.width)
        this.defaultWidth=MsgBox.width;  
      else
        this.defaultWidth = 340;
      if( MsgBox.height )
        this.defaultHeight = MsgBox.height;
      else
        this.defaultHeight = 55;
      //删除的弹窗改变部分样式的高宽
      if( MsgBox.type == 'delete'){
        $(".top").css('height',20);
        $(".msgcontent").css('padding-top',8);
      }
      if( MsgBox.height === "auto" ){ 
        $("#dvMsgCT").height( "auto" );
      }
      else
      //消息区域的高度
      $("#dvMsgCT").height( this.defaultHeight + 'px' );
    
      //整个弹窗的宽度
      $("#dvMsgBox").width( this.defaultWidth + 'px' );
      
      if(MsgBox.title)
        $("#dvMsgTitle").html(MsgBox.title);  
      else
        $("#dvMsgTitle").html("提示");
      
      if(!MsgBox.buttons||(!MsgBox.buttons.yes&&!MsgBox.buttons.no)){  
        MsgBox.buttons={yes:'确定'};  
      }  
      if(MsgBox.msg)
      {
        var msg = '<div class="msgcontent">'+MsgBox.msg+'</div>';
        $("#dvMsgCT").html(msg);
      }
      $("#dvMsgBtns").html("<div class='height'></div>");
      if(MsgBox.buttons.yes){ 
        $("#dvMsgBtns").append(this.createBtn('yes',MsgBox.buttons.yes,MsgBox.fn,MsgBox.type));
        if(MsgBox.buttons.no)
          $("#dvMsgBtns").append(document.createTextNode('　'));  
      }
      
      if(MsgBox.buttons.no)
        $("#dvMsgBtns").append(this.createBtn('no',MsgBox.buttons.no,MsgBox.fn,MsgBox.type));  
      ShowMessage.initPosition();  
      
      $("#dvMsgBox").show();
      if(MsgBox.position != null){
         $("#dvMsgBox").css("top", MsgBox.position.y);
        $("#dvMsgBox").css("left",(MsgBox.position.x-200));
      }
      else{
        this.onResize(false,this.defaultWidth); 
      }
    },  
    hide:function(){  
        $("#dvMsgBox").hide();
    },
    onResize:function(isResize,width){  
       if(isResize)
         ShowMessage.initPosition(); 
       $("#dvMsgBox").css("top", Math.floor((ShowMessage.Position.x - 120 ) / 2+ShowMessage.Position.top)+'px');
       $("#dvMsgBox").css("left", Math.floor(( ShowMessage.Position.y - width) / 2+ShowMessage.Position.left)+'px');
    }  
  };
});
function MsgBoxclose(){
  ShowMessage.Msg.hide();
}
/*
*淡入淡出轮播
*
*/
var slide_count,slide_t;
$(function(){	
  $.fn.Slide = function( opt ){
    //默认参数 
    var defaults = {  
      autoShow:false, //自动轮播
      SlideSpeed:null, //自动轮播间隔
      //轮播图片小图标
      ClickIco:{Ico:null,  //轮播小图标
                IcoClass:"", //轮播时小图标样式
                hidden:false}, //是否隐藏小图标 
     //轮播左右按钮
      ClickBar:{Left:null, //左按钮
                Right:null, //右按钮
                BtnClass:""}, //按钮样式
      fadeInSpeed:500, //图片淡入时间
      fadeOutSpeed:100 //图片淡出时间
    };
      //设定参数
    var par = $.extend( defaults, opt||{} ); 
    var ImgLi = $( this ).find( "li" );
    //当前轮播图片索引
    slide_t = ImgLi.index( ImgLi.filter( ":visible" ) );
    //轮播图片个数
    slide_count = ImgLi.length;
      //从第一张图片开始轮播
    ImgLi.not( ImgLi.eq(0) ).hide();
    var IcoLi = par.ClickIco.Ico.find( "li" );
    var IcoClass = par.ClickIco.IcoClass ;
    //是否隐藏小图标
    if(par.ClickIco.hidden)
       par.ClickIco.Ico.hide();

    IcoLi.eq(0).find( "div" ).removeClass( IcoClass );

    var LeftBar = par.ClickBar.Left;
    var RightBar = par.ClickBar.Right;
    var BarClass = par.ClickBar.BtnClass;
    //如果是自动轮播
    if( par.autoShow )
    {
      IcoLi.click(function(){
        IcoLi.eq(slide_t).find( "div" ).addClass( IcoClass);
        slide_t = IcoLi.index(this);
        ImgLi.filter( ":visible" ).fadeOut( par.fadeOutSpeed ).parent().children().eq(slide_t).fadeIn( par.fadeInSpeed );
        IcoLi.eq(slide_t).find( "div" ).removeClass( IcoClass );
      });
 
      var Show = setInterval( function(){ShowPi(IcoLi)}, par.SlideSpeed );
      $(this).parent().hover(
        function(){
          clearInterval( Show );
          LeftBar.addClass(BarClass);
          RightBar.addClass(BarClass);
      },function(){
          LeftBar.removeClass(BarClass);
          RightBar.removeClass(BarClass);
          Show = setInterval( function(){ShowPi(IcoLi)}, par.SlideSpeed );
      });  
    }
    else{
		  IcoLi.click(function(){
      IcoLi.eq(slide_t).find( "div" ).addClass( IcoClass);
      slide_t = IcoLi.index(this);
      ImgLi.filter( ":visible" ).fadeOut( par.fadeOutSpeed ).parent().children().eq(slide_t).fadeIn( par.fadeInSpeed );
      IcoLi.eq(slide_t).find( "div" ).removeClass( IcoClass );
      });
		}
    LeftBar.click(function(){
      if( slide_t>=1 )
        --slide_t ;
      else
      slide_t = slide_count-1;

      ImgLi.filter(":visible").fadeOut( par.fadeOutSpeed ).parent().children().eq(slide_t).fadeIn( par.fadeInSpeed );
      IcoLi.eq(slide_t).find("div").removeClass(IcoClass);
      IcoLi.eq(slide_t).siblings().find("div").addClass(IcoClass);
    });
    RightBar.click(function(){
      if( slide_t<slide_count-1 )
        ++slide_t;
      else
        slide_t = 0;

      ImgLi.filter(":visible").fadeOut( par.fadeOutSpeed ).parent().children().eq(slide_t).fadeIn( par.fadeInSpeed );
      IcoLi.eq(slide_t).find("div").removeClass(IcoClass);
      IcoLi.eq(slide_t).siblings().find("div").addClass(IcoClass);	
    });
  }
})
/*
* 轮播时调用函数，绑定click事件
*/
var slide_n=0 ;
function  ShowPi(ret){
  slide_n=slide_t
  slide_n = slide_n >=slide_count-1  ? 0 : ++slide_n;				
  ret.eq(slide_n).trigger("click");
}
//pngbug.js

function correctPNG() // correctly handle PNG transparency in Win IE 5.5 & 6.
{
    var arVersion = navigator.appVersion.split("MSIE")
    var version = parseFloat(arVersion[1])
    if ((version >= 5.5) && (document.body.filters))
    {
       for(var j=0; j<document.images.length; j++)
       {
          var img = document.images[j]
          var imgName = img.src.toUpperCase()
          if (imgName.substring(imgName.length-3, imgName.length) == "PNG")
          {
             var imgID = (img.id) ? "id='" + img.id + "' " : ""
             var imgClass = (img.className) ? "class='" + img.className + "' " : ""
             var imgTitle = (img.title) ? "title='" + img.title + "' " : "title='" + img.alt + "' "
             var imgStyle = "display:inline-block;" + img.style.cssText
             if (img.align == "left") imgStyle = "float:left;" + imgStyle
             if (img.align == "right") imgStyle = "float:right;" + imgStyle
             if (img.parentElement.href) imgStyle = "cursor:hand;" + imgStyle
             var strNewHTML = "<span " + imgID + imgClass + imgTitle
             + " style=\"" + "width:" + img.width + "px; height:" + img.height + "px;" + imgStyle + ";"
             + "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader"
             + "(src=\'" + img.src + "\', sizingMethod='scale');\"></span>"
             img.outerHTML = strNewHTML
             j = j-1
          }
       }
    }    
}

if ($.browser.msie && ($.browser.version == "6.0")) {
  window.attachEvent("onload", correctPNG);
} 
/*
  头部导航实现
*/
$(function(){
	  var navUl = $(".mainNavUl>li");
		navUl.mouseover(	
			function(){
			  var nav = navUl.index(this); 
        var LazyObj; //导航慢加载对象
			  if(nav==1){
          $(".female").show();
          LazyObj = $(".female");
        }
				else if(nav==2){
          $(".male").show();
          LazyObj = $(".male");
        }
				else if(nav==3){
          $(".children").show();
          LazyObj = $(".children");
        }
        else if(nav == 4){
          $(".aimerbrand_11").show();
          LazyObj = $(".aimerbrand_11");
        }
        else{  
          $(".children").hide();
          $(".female").hide();
          $(".male").hide();
          $(".aimerbrand_11").hide();
          LazyObj = null
        }
        if(LazyObj != null){
          //导航图片慢加载实现
          LazyObj.find("img").each(function(){
            var src = $(this).attr("lazysrc");
            var pic_src = $(this).attr("src");
            $(this).attr("src",src);
          });
        }
			})
		  .mouseout(function(){
				$(".children").hide();$(".female").hide();$(".male").hide();$(".aimerbrand_11").hide();
			});
			$(".female").hover(function(){$(".female").show();navUl.eq(1).addClass("mainNavShow")}
					               ,function(){$(".female").hide();navUl.eq(1).removeClass("mainNavShow")});
			$(".male").hover(function(){$(".male").show();navUl.eq(2).addClass("mainNavShow")}
							          ,function(){$(".male").hide();navUl.eq(2).removeClass("mainNavShow")});
			$(".children").hover(function(){$(".children").show();navUl.eq(3).addClass("mainNavShow")}
										   	,function(){$(".children").hide();navUl.eq(3).removeClass("mainNavShow")});
      $(".aimerbrand_11").hover(function(){$(".aimerbrand_11").show();navUl.eq(4).addClass("mainNavShow")}
										   	,function(){$(".aimerbrand_11").hide();navUl.eq(4).removeClass("mainNavShow")});
      $(".blushRed").hover(function(){
        $(this).find("p,a,div").addClass("red")
      },function(){
        $(this).find("p,a,div").removeClass("red")
      });
      
      $(".jsBorder").hover(function(){
        var $this = $(this);
        function way(){
          $this.find("em").fadeIn();
          $this.find(".ltemName a").addClass("red");
        };
        timer=setTimeout(way,5);
      },function(){
        clearTimeout(timer);
        var $this = $(this);
        $this.find("em").fadeOut();
        $this.find(".ltemName a").removeClass("red");
      });
    //头部网站导航下拉
    $(".show_user").hover(function(){
      $(".dropbox003").slideDown( "fast" );
    },function(){
      var slideuptimer = setTimeout( "$(\".dropbox003\").slideUp( \"fast\" )", 1000 );
      $(".dropbox003").hover(function(){
        clearTimeout(slideuptimer);
      },
      function(){
        $(".dropbox003").slideUp( "fast" );
      });
    });
    //头部网站导航下拉
     $(".show_user02").hover(function(){
      $(".dropbox004").slideDown( "fast" );
    },function(){
      var slideuptimer = setTimeout( "$(\".dropbox004\").slideUp( \"fast\" )", 1000 );
      $(".dropbox004").hover(function(){
        clearTimeout(slideuptimer);
      },
      function(){
        $(".dropbox004").slideUp( "fast" );
      });
    });
   })
$.fn.smartFloat = function() {
  var position = function(element) {
    var top = element.position().top; //浮层的高度
    $(window).scroll(function() {
      ScrollEvent( element,top )
    });
  };
  return $(this).each(function() {
      position($(this));                         
  });
}
function ScrollEvent( element, top ){
  var scrolls = $(this).scrollTop(); //滚动条的高度
  var height = $(window).height();
  var fl_height = element.height();
  if( top+fl_height > height+ scrolls ){
    var pos_y =  height - fl_height
    if (window.XMLHttpRequest) { 
      element.css({
        position: 'fixed',
        top: pos_y
      });    
    }
    else{
      element.css({
        top: scrolls
      });    
    }
    element.parent().css({height:fl_height});
  }
  else{
    element.css({
      position: "absolute",
      top: top-20
    });  
    element.parent().css({height:fl_height});
  }
}

// 手机号码正则表达式验证
function regMobile( mobile )
{
  if( isNaN( mobile ) )
    return false;
  else
  {
    if( mobile.length == 8 )
    {
      var regex = /^(1|5|6|7|9)\d{7}$/;
      return regex.test( mobile );
    }
    else if( mobile.length == 9 )
    {
      var regex = /^(1|5|6|7|9)\d{8}$/;
      return regex.test( mobile );
    }
    else if( mobile.length == 11 )
    {
      var regex = /^1\d{10}$/;
      return regex.test( mobile );
    }
    else if( mobile.length == 13 )
    {
      var regex = /^[1,5,6,9]\d{12}/;
      return regex.test( mobile );
    }
  }
}

/*
 * 座机号码验证
 */
function is_phone( phone )
{
  switch( phone.length )
  {
    case '6':
      var regex = /^\d{6}/;
      return regex.test( phone );      //香港座机号码验证
    case '8': 
      var regex = /^(2|3)\d{7}$/;
      return regex.test( phone );  //澳門座机号码验证
    case '10':
      var regex = /^0\d{9}$/;      //台湾地区座机号码验证
      return regex.test( phone );
    default: 
      var regex = /^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/;
      return regex.test( phone );  //大陸地区座机号码验证
  }
}

/*
 * 7周年寻宝
 */
 function xunbao( id )
{
    //判断是否已登录  
    if( !CURRENT_USER ) 
    {
      operatorLogin();
      return false;
    }

    $.ajax({
      url: "/lottery/xunbao2016",
      type: "POST",
      async: false,
      data: {"id": id},
      dataType: "json",
      success: function(ret)
      {
        if (ret.status == "ok")
        {
            //成功部分
            if( ret.data.success == "1" )
            {
              var res =  ret.data.res;
              var en_color = ret.data.id;  // 英文
              var color = ret.data.category;   //当前选中的颜色 中文

              //改背景图
              if( ret.data.count <= 3 )
              {
                var num = ret.data.count;//获取几个了
                var other = 4  - parseInt(num);
                var str = '恭喜您<br>获得<span>'+num+'</span>张通关卡';
                var str1 = '再找'+other+'张，就能得到优惠券啦';
                $('.dajiang').remove();
                $('.xiaojiang').html(str);
                $('.mycoupon').remove();
                $('.braBoxOt').html(str1);
              }else{
                var num = ret.data.count;//获取几个了
                var other = 8  - parseInt(num);
                var str3;
                switch(num)
                {
                  case 4:
                    str3 = "恭喜获得10元优惠券一张！";
                    break;
                  case 5:
                    str3 = "恭喜获得20元优惠券一张";  
                    break;
                  case 6:
                    str3 = "恭喜获得30元优惠券一张";
                    break;
                  case 7:
                    str3 = "恭喜获得50元优惠券一张";
                    break;
                  default:
                      break;
                }
                if(other > 0)
                {
                  var str = '恭喜您<br>获得<span>'+num+'</span>张通关卡<p class="braPrize">'+str3+'</p>';
                  var str1 = '再找'+other+'张，就能得到终极大奖！';
                  $('.dajiang').remove();
                  $('.xiaojiang').html(str);
                  $('.braBoxOt').html(str1);
                }else{
                  var dajiang_count = 8 - ret.data.count; //巨奖
                  if( dajiang_count == 0)
                  {
                      $('.xiaojiang').remove();
                      $('.braBoxOt').empty();
                      $('.dajiang').html('恭喜您找到所有通关卡<p class="braPrize">获得100元优惠券一张<br>及礼品卡一张</p>！');
                  }                  
                }
              }
              $('.blockBj , .yearColorBan').show();
            }else{   //已选择过
              var res =  ret.data.res;
              var en_color = ret.data.id;  // 英文
              var color = ret.data.category;   //当前选中的颜色 中文

              //改背景图
              if( ret.data.count <= 3 )
              {
                var num = ret.data.count;//获取几个了
                var other = 4  - parseInt(num);
                var str = '您已找到该通关卡<br>请继续加油哦~';
                var str1 = '再找'+other+'张，就能得到优惠券啦';
                $('.dajiang').remove();
                $('.xiaojiang').html(str);
                $('.mycoupon').remove();
                $('.braBoxOt').html(str1);
              }else{
                var num = ret.data.count;//获取几个了
                var other = 8  - parseInt(num);
                var str3;
                switch(num)
                {
                  case 4:
                    str3 = "已经获得10元优惠券一张！";
                    break;
                  case 5:
                    str3 = "已经获得20元优惠券一张";  
                    break;
                  case 6:
                    str3 = "已经获得30元优惠券一张";
                    break;
                  case 7:
                    str3 = "已经获得50元优惠券一张";
                    break;
                  default:
                      break;
                }
                if(other >0)
                {
                    var str = '您已找到该通关卡<br>请继续加油哦';
                    $('.dajiang').remove();
                    $('.xiaojiang').html(str);
                    $('.braBoxOt').empty();              
                }else{
                  var dajiang_count = 8 - ret.data.count; //巨奖
                  if( dajiang_count == 0)
                  {
                      $('.xiaojiang').remove();
                      $('.braBoxOt').empty();
                      $('.dajiang').html('恭喜您找到所有通关卡<p class="braPrize">获得100元优惠券一张<br>及礼品卡一张</p>！');
                  }                 
                }
              }

              $('.blockBj , .yearColorBan').show();
            }
        }else
        {  
           alert( ret.data );
        }
      }
    });
}

    $(function(){
       $('.yearColorBan').css({
        left: ($( window ).width() - $(".braBoxMain").width()) / 2 + 'px',
        top: ($(window).height() - $(".braBoxMain").height())/2 + 'px'
      })
//      $(".yCgame").click(function(){
//          $('.blockBj , .yearColorBan').show();
//      })
      $('.braClose').click(function(){
          $('.blockBj , .yearColorBan').hide();
      })
      $('.yCTgmj').mouseover(function(){
          $(".yCEwm").show();
      })
      $('.yCTgmj').mouseleave(function(){
          $(".yCEwm").hide();
      })
    })
